//
// Http Server
//
class HttpServer(port, func)
{
	class HttpConnection(sock, connectionId)
	{
		var _sock = sock;
		var _connectionId = connectionId;
	}
	
	var _connections = [ ];
	
	var _sock = new TCPSocket(port, function(event, connectionId) {
		switch(event) {
			case TCPSocket.Connected:
				printf("TCPSocket connected. ConnectionId=%d\n", connectionId);
				connection[connectionId] = new HttpConnection(_sock, connectionId);
				send(connectionId, "Hello there\n");
			case TCPSocket.Disconnected:
				printf("TCPSocket disconnected. ConnectionId=%d\n", connectionId);
				connection[connectionId] = null;
			default:
				printf("TCPSocket fired. event=%d\n", event);
		}
	});
}

var server = new HttpServer(8080, function() { printf("Got it!\n"); });
